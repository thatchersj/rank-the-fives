<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Eton Fives Rankings</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/datatables.net-dt@2.0.8/css/dataTables.dataTables.min.css">
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
    header { display:flex; gap:16px; align-items:baseline; justify-content:space-between; flex-wrap:wrap; }
    h1 { margin:0; font-size: 24px; }
    .meta { color:#555; font-size: 14px; }
    .actions { display:flex; gap:12px; flex-wrap:wrap; }
    .actions a, .actions button {
      appearance:none; border:1px solid #ccc; border-radius:10px; padding:10px 12px;
      background:white; cursor:pointer; text-decoration:none; color:#111; font-size:14px;
    }
    .actions a:hover, .actions button:hover { background:#f6f6f6; }
    .note { margin: 12px 0 18px; color:#666; font-size: 14px; line-height:1.4; }
    table.dataTable thead th { white-space: nowrap; }
    .small { font-size: 12px; color:#666; }
  </style>
</head>
<body>
  <header>
    <div>
      <h1>Eton Fives Rankings</h1>
      <div class="meta" id="lastUpdated">Loadingâ€¦</div>
    </div>
    <div class="actions">
      <a href="./downloads/rankings_latest.xlsx" download>Download XLSX</a>
      <a href="./downloads/rankings_latest.csv" download>Download CSV</a>
      <a href="https://github.com/" id="issueLink" target="_blank" rel="noopener">Submit new results (GitHub Issue)</a>
    </div>
  </header>

  <div class="note">
    Search, sort, and filter the live rankings below. Cells show best finish per tournament: <b>W</b>, <b>F</b>, <b>SF</b>, <b>QF</b>, <b>L16</b>, <b>NQ</b>, and <b>P</b> (did not play).
    <div class="small">Tip: click a column header to sort, or use the search box to find a player.</div>
  </div>

  <table id="rankings" class="display" style="width:100%">
    <thead><tr id="theadRow"></tr></thead>
    <tbody></tbody>
  </table>

  <script src="https://cdn.jsdelivr.net/npm/datatables.net@2.0.8/js/dataTables.min.js"></script>
  <script>
    async function main() {
      const repo = (new URLSearchParams(location.search)).get("repo");
      const issueLink = document.getElementById("issueLink");
      if (repo) issueLink.href = `https://github.com/${repo}/issues/new?template=submit_results.yml`;

      const res = await fetch("./data/rankings_latest.json", {cache: "no-store"});
      const data = await res.json();

      if (!data.length) {
        document.getElementById("lastUpdated").textContent = "No data found.";
        return;
      }

      const cols = Object.keys(data[0]);

      // Header
      const thead = document.getElementById("theadRow");
      cols.forEach(c => {
        const th = document.createElement("th");
        th.textContent = c;
        thead.appendChild(th);
      });

      // Rows
      const tbody = document.querySelector("#rankings tbody");
      data.forEach(row => {
        const tr = document.createElement("tr");
        cols.forEach(c => {
          const td = document.createElement("td");
          td.textContent = (row[c] ?? "");
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      // Last updated from the first row's Rankings file timestamp via HTTP header not available on GH Pages;
      // so we display today's date from the browser.
      const now = new Date();
      document.getElementById("lastUpdated").textContent = `Last updated: ${now.toLocaleString()}`;

      new DataTable("#rankings", {
        pageLength: 25,
        scrollX: true,
        order: [[0, "asc"]],
      });
    }
    main().catch(err => {
      document.getElementById("lastUpdated").textContent = "Failed to load rankings data.";
      console.error(err);
    });
  </script>
</body>
</html>
